version: 0.4.0
kind: app
metadata:
  name: "å¤–éƒ¨çŸ¥è¯†åº“å·¥ä½œæµ"
  description: "æ”¯æŒå¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢çš„æ™ºèƒ½é—®ç­”å·¥ä½œæµ"
  author: "Dify Assistant"
  icon: "ğŸ¤–"
  icon_background: "#FFEAD5"
  tags: ["knowledge", "external", "workflow", "rag"]
spec:
  app:
    mode: workflow
    icon: "ğŸ¤–"
    icon_background: "#FFEAD5"
    name: "å¤–éƒ¨çŸ¥è¯†åº“å·¥ä½œæµ"
    description: "æ”¯æŒå¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢çš„æ™ºèƒ½é—®ç­”å·¥ä½œæµ"
    tags: ["knowledge", "external", "workflow", "rag"]
    workflow:
      graph:
        nodes:
          - id: "start"
            type: "start"
            data:
              title: "å¼€å§‹"
              desc: "å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹"
              variables:
                - variable: "query"
                  label: "ç”¨æˆ·é—®é¢˜"
                  type: "text-input"
                  required: true
                  max_length: 1000
                  options: []
                - variable: "external_knowledge_id"
                  label: "å¤–éƒ¨çŸ¥è¯†åº“ID"
                  type: "text-input"
                  required: true
                  max_length: 100
                  options: []
          - id: "knowledge_retrieval"
            type: "knowledge-retrieval"
            data:
              title: "çŸ¥è¯†æ£€ç´¢"
              desc: "ä»å¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯"
              query_variable_selector: ["start", "query"]
              dataset_ids: ["external_dataset_id"]
              retrieval_mode: "multiple"
              multiple_retrieval_config:
                top_k: 5
                score_threshold: 0.7
                reranking_mode: "reranking_model"
                reranking_enable: true
                reranking_model:
                  provider: "cohere"
                  model: "rerank-multilingual-v2.0"
              metadata_filtering_mode: "disabled"
              vision:
                enabled: false
                configs:
                  detail: "high"
              error_strategy: "fallback"
              retry_config:
                enabled: true
                max_retries: 3
                retry_interval: 1
              default_value_dict:
                result: []
          - id: "llm"
            type: "llm"
            data:
              title: "LLMå¤„ç†"
              desc: "ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹å¤„ç†æ£€ç´¢ç»“æœå¹¶ç”Ÿæˆå›ç­”"
              model:
                provider: "openai"
                name: "gpt-4o"
                mode: "chat"
                completion_params:
                  temperature: 0.7
                  max_tokens: 2000
                  top_p: 1
                  presence_penalty: 0
                  frequency_penalty: 0
              prompt_template:
                - role: "system"
                  text: |
                    ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œè¯·åŸºäºæä¾›çš„çŸ¥è¯†åº“ä¿¡æ¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
                    
                    è¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
                    1. åŸºäºæ£€ç´¢åˆ°çš„çŸ¥è¯†åº“å†…å®¹å›ç­”é—®é¢˜
                    2. å¦‚æœçŸ¥è¯†åº“ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®è¯´æ˜
                    3. å›ç­”è¦å‡†ç¡®ã€æœ‰ç”¨ã€ç®€æ´
                    4. å¼•ç”¨æ¥æºæ—¶è¯·æ³¨æ˜å‡ºå¤„
                - role: "user"
                  text: |
                    ç”¨æˆ·é—®é¢˜ï¼š{{#start.query#}}
                    
                    çŸ¥è¯†åº“æ£€ç´¢ç»“æœï¼š
                    {{#knowledge_retrieval.result#}}
              vision:
                enabled: false
                configs:
                  detail: "high"
              error_strategy: "fallback"
              retry_config:
                enabled: true
                max_retries: 3
                retry_interval: 1
              default_value_dict:
                text: "æŠ±æ­‰ï¼Œæˆ‘æ— æ³•å¤„ç†æ‚¨çš„é—®é¢˜ã€‚"
          - id: "end"
            type: "end"
            data:
              title: "ç»“æŸ"
              desc: "å·¥ä½œæµç»“æŸèŠ‚ç‚¹"
              outputs:
                - value_selector: ["llm", "text"]
                  variable: "answer"
        edges:
          - id: "start-to-knowledge"
            source: "start"
            target: "knowledge_retrieval"
          - id: "knowledge-to-llm"
            source: "knowledge_retrieval"
            target: "llm"
          - id: "llm-to-end"
            source: "llm"
            target: "end"
      features:
        file_upload:
          enabled: false
          image:
            enabled: false
            number_limits: 3
            detail: "high"
            transfer_methods: ["remote_url", "local_file"]
        opening_statement: "æ‚¨å¥½ï¼æˆ‘æ˜¯æ”¯æŒå¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨çš„é—®é¢˜ã€‚"
        suggested_questions: 
          - "å¦‚ä½•ä½¿ç”¨å¤–éƒ¨çŸ¥è¯†åº“ï¼Ÿ"
          - "å¤–éƒ¨çŸ¥è¯†åº“æ”¯æŒå“ªäº›åŠŸèƒ½ï¼Ÿ"
          - "å¦‚ä½•é…ç½®å¤–éƒ¨çŸ¥è¯†åº“APIï¼Ÿ"
        suggested_questions_after_answer:
          enabled: true
        speech_to_text:
          enabled: false
        text_to_speech:
          enabled: false
        citation: true
        retriever_resource:
          enabled: true
        sensitive_word_avoidance:
          enabled: false
        more_like_this:
          enabled: false
        user_input_form: []
        system_parameters: []
        opening_statement: "æ‚¨å¥½ï¼æˆ‘æ˜¯æ”¯æŒå¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨çš„é—®é¢˜ã€‚"
        suggested_questions: 
          - "å¦‚ä½•ä½¿ç”¨å¤–éƒ¨çŸ¥è¯†åº“ï¼Ÿ"
          - "å¤–éƒ¨çŸ¥è¯†åº“æ”¯æŒå“ªäº›åŠŸèƒ½ï¼Ÿ"
          - "å¦‚ä½•é…ç½®å¤–éƒ¨çŸ¥è¯†åº“APIï¼Ÿ"
        suggested_questions_after_answer:
          enabled: true
        speech_to_text:
          enabled: false
        text_to_speech:
          enabled: false
        citation: true
        retriever_resource:
          enabled: true
        sensitive_word_avoidance:
          enabled: false
        more_like_this:
          enabled: false
        user_input_form: []
        system_parameters: []